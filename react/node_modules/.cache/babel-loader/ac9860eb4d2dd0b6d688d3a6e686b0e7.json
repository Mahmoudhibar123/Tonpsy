{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar _require = require('./util'),\n    pathOr = _require.pathOr;\n\nvar State = function State() {\n  var _this = this;\n\n  _classCallCheck(this, State);\n\n  Object.defineProperty(this, 'pubSubCount', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          subscribers = _this.subscribers;\n      /* eslint-disable no-param-reassign */\n\n      var pubs = Object.keys(publishers).reduce(function (acc, source) {\n        acc[source] = Object.keys(publishers[source]).length;\n        acc.total += acc[source];\n        return acc;\n      }, {\n        camera: 0,\n        screen: 0,\n        total: 0\n      });\n      var subs = Object.keys(subscribers).reduce(function (acc, source) {\n        acc[source] = Object.keys(subscribers[source]).length;\n        acc.total += acc[source];\n        return acc;\n      }, {\n        camera: 0,\n        screen: 0,\n        sip: 0,\n        total: 0\n      });\n      /* eslint-enable no-param-reassign */\n\n      return {\n        publisher: pubs,\n        subscriber: subs\n      };\n    }\n  });\n  Object.defineProperty(this, 'getPubSub', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          subscribers = _this.subscribers,\n          pubSubCount = _this.pubSubCount;\n      return {\n        publishers: publishers,\n        subscribers: subscribers,\n        meta: pubSubCount()\n      };\n    }\n  });\n  Object.defineProperty(this, 'all', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var streams = _this.streams,\n          streamMap = _this.streamMap,\n          getPubSub = _this.getPubSub;\n      return Object.assign({}, {\n        streams: streams,\n        streamMap: streamMap\n      }, getPubSub());\n    }\n  });\n  Object.defineProperty(this, 'getSession', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.session;\n    }\n  });\n  Object.defineProperty(this, 'setSession', {\n    enumerable: true,\n    writable: true,\n    value: function value(otSession) {\n      _this.session = otSession;\n    }\n  });\n  Object.defineProperty(this, 'getCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.credentials;\n    }\n  });\n  Object.defineProperty(this, 'setCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value(otCredentials) {\n      _this.credentials = otCredentials;\n    }\n  });\n  Object.defineProperty(this, 'getOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.options;\n    }\n  });\n  Object.defineProperty(this, 'setOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value(otOptions) {\n      _this.options = otOptions;\n    }\n  });\n  Object.defineProperty(this, 'addStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      _this.streams[stream.id] = stream;\n    }\n  });\n  Object.defineProperty(this, 'removeStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      var streamMap = _this.streamMap,\n          subscribers = _this.subscribers,\n          streams = _this.streams;\n      var type = pathOr('sip', 'videoType', stream);\n      var subscriberId = streamMap[stream.id];\n      delete streamMap[stream.id];\n      delete subscribers[type][subscriberId];\n      delete streams[stream.id];\n    }\n  });\n  Object.defineProperty(this, 'getStreams', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.streams;\n    }\n  });\n  Object.defineProperty(this, 'getStreamMap', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.streamMap;\n    }\n  });\n  Object.defineProperty(this, 'addPublisher', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, publisher) {\n      _this.streamMap[publisher.streamId] = publisher.id;\n      _this.publishers[type][publisher.id] = publisher;\n    }\n  });\n  Object.defineProperty(this, 'removePublisher', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, publisher) {\n      var streamMap = _this.streamMap,\n          publishers = _this.publishers;\n      var id = publisher.id || streamMap[publisher.streamId];\n      delete publishers[type][id];\n      delete streamMap[publisher.streamId];\n    }\n  });\n  Object.defineProperty(this, 'removeAllPublishers', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          removePublisher = _this.removePublisher;\n      ['camera', 'screen'].forEach(function (type) {\n        Object.values(publishers[type]).forEach(function (publisher) {\n          removePublisher(type, publisher);\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'addSubscriber', {\n    enumerable: true,\n    writable: true,\n    value: function value(subscriber) {\n      var subscribers = _this.subscribers,\n          streamMap = _this.streamMap;\n      var streamId = subscriber.stream.id;\n      var type = pathOr('sip', 'stream.videoType', subscriber);\n      subscribers[type][subscriber.id] = subscriber;\n      streamMap[streamId] = subscriber.id;\n    }\n  });\n  Object.defineProperty(this, 'removeSubscriber', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, subscriber) {\n      var subscribers = _this.subscribers,\n          streamMap = _this.streamMap;\n      var id = subscriber.id || streamMap[subscriber.streamId];\n      delete subscribers[type][id];\n      delete streamMap[subscriber.streamId];\n    }\n  });\n  Object.defineProperty(this, 'removeAllSubscribers', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      ['camera', 'screen', 'sip'].forEach(function (type) {\n        Object.values(_this.subscribers[type]).forEach(function (subscriber) {\n          _this.removeSubscriber(type, subscriber);\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'reset', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var removeAllPublishers = _this.removeAllPublishers,\n          removeAllSubscribers = _this.removeAllSubscribers,\n          streams = _this.streams,\n          streamMap = _this.streamMap;\n      removeAllPublishers();\n      removeAllSubscribers();\n      [streams, streamMap].forEach(function (streamObj) {\n        Object.keys(streamObj).forEach(function (streamId) {\n          delete streamObj[streamId]; // eslint-disable-line no-param-reassign\n        });\n      });\n    }\n  });\n  this.publishers = {\n    camera: {},\n    screen: {}\n  }; // Map subscriber id to subscriber objects\n\n  this.subscribers = {\n    camera: {},\n    screen: {},\n    sip: {}\n  }; // Map stream ids to stream objects\n\n  this.streams = {}; // Map stream ids to subscriber/publisher ids\n\n  this.streamMap = {}; // The OpenTok session\n\n  this.session = null; // OpenTok session credentials\n\n  this.credentials = null; // Core options\n\n  this.options = null;\n}\n/**\n* Internal methods\n*/\n\n/**\n * Returns the count of current publishers and subscribers by type\n * @retuns {Object}\n *    {\n *      publishers: {\n *        camera: 1,\n *        screen: 1,\n *        total: 2\n *      },\n *      subscribers: {\n *        camera: 3,\n *        screen: 1,\n *        total: 4\n *      }\n *   }\n */\n\n/**\n * Returns the current publishers and subscribers, along with a count of each\n * @returns {Object}\n */\n\n/**\n * Get streams, streamMap, publishers, and subscribers\n * @return {Object}\n */\n\n/**\n * Get the current OpenTok session\n * @returns {Object}\n */\n\n/**\n * Set the current OpenTok session\n * @param {Object} otSession\n */\n\n/**\n * Get the current OpenTok credentials\n * @returns {Object}\n */\n\n/**\n * Set the current OpenTok credentials\n * @param {Object} otCredentials\n */\n\n/**\n * Get the options defined for core\n * @returns {Object}\n */\n\n/**\n * Set the options defined for core\n * @param {Object} otOptions\n */\n\n/**\n * Add a stream to state\n * @param {Object} stream - An OpenTok stream object\n */\n\n/**\n * Remove a stream from state and any associated subscribers\n * @param {Object} stream - An OpenTok stream object\n */\n\n/**\n * Get all remote streams\n * @returns {Object}\n */\n\n/**\n * Get the map of stream ids to publisher/subscriber ids\n * @returns {Object}\n */\n\n/**\n * Add a publisher to state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} publisher - The OpenTok publisher object\n */\n\n/**\n * Remove a publisher from state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} publisher - The OpenTok publisher object\n */\n\n/**\n * Remove all publishers from state\n */\n\n/**\n * Add a subscriber to state\n * @param {Object} - An OpenTok subscriber object\n */\n\n/**\n * Remove a publisher from state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} subscriber - The OpenTok subscriber object\n */\n\n/**\n * Remove all subscribers from state\n */\n\n/**\n * Reset state\n */\n;\n/** Export */\n\n\nexports.default = State;","map":{"version":3,"sources":["/home/fizoumizou/Documents/pfe/react/node_modules/opentok-accelerator-core/dist/state.js"],"names":["Object","defineProperty","exports","value","_classCallCheck","instance","Constructor","TypeError","_require","require","pathOr","State","_this","enumerable","writable","publishers","subscribers","pubs","keys","reduce","acc","source","length","total","camera","screen","subs","sip","publisher","subscriber","pubSubCount","meta","streams","streamMap","getPubSub","assign","session","otSession","credentials","otCredentials","options","otOptions","stream","id","type","subscriberId","streamId","removePublisher","forEach","values","removeSubscriber","removeAllPublishers","removeAllSubscribers","streamObj","default"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar _require = require('./util'),\n    pathOr = _require.pathOr;\n\nvar State = function State() {\n  var _this = this;\n\n  _classCallCheck(this, State);\n\n  Object.defineProperty(this, 'pubSubCount', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          subscribers = _this.subscribers;\n      /* eslint-disable no-param-reassign */\n\n      var pubs = Object.keys(publishers).reduce(function (acc, source) {\n        acc[source] = Object.keys(publishers[source]).length;\n        acc.total += acc[source];\n        return acc;\n      }, { camera: 0, screen: 0, total: 0 });\n\n      var subs = Object.keys(subscribers).reduce(function (acc, source) {\n        acc[source] = Object.keys(subscribers[source]).length;\n        acc.total += acc[source];\n        return acc;\n      }, { camera: 0, screen: 0, sip: 0, total: 0 });\n      /* eslint-enable no-param-reassign */\n      return { publisher: pubs, subscriber: subs };\n    }\n  });\n  Object.defineProperty(this, 'getPubSub', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          subscribers = _this.subscribers,\n          pubSubCount = _this.pubSubCount;\n\n      return { publishers: publishers, subscribers: subscribers, meta: pubSubCount() };\n    }\n  });\n  Object.defineProperty(this, 'all', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var streams = _this.streams,\n          streamMap = _this.streamMap,\n          getPubSub = _this.getPubSub;\n\n      return Object.assign({}, { streams: streams, streamMap: streamMap }, getPubSub());\n    }\n  });\n  Object.defineProperty(this, 'getSession', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.session;\n    }\n  });\n  Object.defineProperty(this, 'setSession', {\n    enumerable: true,\n    writable: true,\n    value: function value(otSession) {\n      _this.session = otSession;\n    }\n  });\n  Object.defineProperty(this, 'getCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.credentials;\n    }\n  });\n  Object.defineProperty(this, 'setCredentials', {\n    enumerable: true,\n    writable: true,\n    value: function value(otCredentials) {\n      _this.credentials = otCredentials;\n    }\n  });\n  Object.defineProperty(this, 'getOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.options;\n    }\n  });\n  Object.defineProperty(this, 'setOptions', {\n    enumerable: true,\n    writable: true,\n    value: function value(otOptions) {\n      _this.options = otOptions;\n    }\n  });\n  Object.defineProperty(this, 'addStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      _this.streams[stream.id] = stream;\n    }\n  });\n  Object.defineProperty(this, 'removeStream', {\n    enumerable: true,\n    writable: true,\n    value: function value(stream) {\n      var streamMap = _this.streamMap,\n          subscribers = _this.subscribers,\n          streams = _this.streams;\n\n      var type = pathOr('sip', 'videoType', stream);\n      var subscriberId = streamMap[stream.id];\n      delete streamMap[stream.id];\n      delete subscribers[type][subscriberId];\n      delete streams[stream.id];\n    }\n  });\n  Object.defineProperty(this, 'getStreams', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.streams;\n    }\n  });\n  Object.defineProperty(this, 'getStreamMap', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      return _this.streamMap;\n    }\n  });\n  Object.defineProperty(this, 'addPublisher', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, publisher) {\n      _this.streamMap[publisher.streamId] = publisher.id;\n      _this.publishers[type][publisher.id] = publisher;\n    }\n  });\n  Object.defineProperty(this, 'removePublisher', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, publisher) {\n      var streamMap = _this.streamMap,\n          publishers = _this.publishers;\n\n      var id = publisher.id || streamMap[publisher.streamId];\n      delete publishers[type][id];\n      delete streamMap[publisher.streamId];\n    }\n  });\n  Object.defineProperty(this, 'removeAllPublishers', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var publishers = _this.publishers,\n          removePublisher = _this.removePublisher;\n\n      ['camera', 'screen'].forEach(function (type) {\n        Object.values(publishers[type]).forEach(function (publisher) {\n          removePublisher(type, publisher);\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'addSubscriber', {\n    enumerable: true,\n    writable: true,\n    value: function value(subscriber) {\n      var subscribers = _this.subscribers,\n          streamMap = _this.streamMap;\n\n      var streamId = subscriber.stream.id;\n      var type = pathOr('sip', 'stream.videoType', subscriber);\n      subscribers[type][subscriber.id] = subscriber;\n      streamMap[streamId] = subscriber.id;\n    }\n  });\n  Object.defineProperty(this, 'removeSubscriber', {\n    enumerable: true,\n    writable: true,\n    value: function value(type, subscriber) {\n      var subscribers = _this.subscribers,\n          streamMap = _this.streamMap;\n\n      var id = subscriber.id || streamMap[subscriber.streamId];\n      delete subscribers[type][id];\n      delete streamMap[subscriber.streamId];\n    }\n  });\n  Object.defineProperty(this, 'removeAllSubscribers', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      ['camera', 'screen', 'sip'].forEach(function (type) {\n        Object.values(_this.subscribers[type]).forEach(function (subscriber) {\n          _this.removeSubscriber(type, subscriber);\n        });\n      });\n    }\n  });\n  Object.defineProperty(this, 'reset', {\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var removeAllPublishers = _this.removeAllPublishers,\n          removeAllSubscribers = _this.removeAllSubscribers,\n          streams = _this.streams,\n          streamMap = _this.streamMap;\n\n      removeAllPublishers();\n      removeAllSubscribers();\n      [streams, streamMap].forEach(function (streamObj) {\n        Object.keys(streamObj).forEach(function (streamId) {\n          delete streamObj[streamId]; // eslint-disable-line no-param-reassign\n        });\n      });\n    }\n  });\n\n  this.publishers = {\n    camera: {},\n    screen: {}\n  };\n\n  // Map subscriber id to subscriber objects\n  this.subscribers = {\n    camera: {},\n    screen: {},\n    sip: {}\n  };\n\n  // Map stream ids to stream objects\n  this.streams = {};\n\n  // Map stream ids to subscriber/publisher ids\n  this.streamMap = {};\n\n  // The OpenTok session\n  this.session = null;\n\n  // OpenTok session credentials\n  this.credentials = null;\n\n  // Core options\n  this.options = null;\n}\n/**\n* Internal methods\n*/\n\n/**\n * Returns the count of current publishers and subscribers by type\n * @retuns {Object}\n *    {\n *      publishers: {\n *        camera: 1,\n *        screen: 1,\n *        total: 2\n *      },\n *      subscribers: {\n *        camera: 3,\n *        screen: 1,\n *        total: 4\n *      }\n *   }\n */\n\n\n/**\n * Returns the current publishers and subscribers, along with a count of each\n * @returns {Object}\n */\n\n\n/**\n * Get streams, streamMap, publishers, and subscribers\n * @return {Object}\n */\n\n\n/**\n * Get the current OpenTok session\n * @returns {Object}\n */\n\n\n/**\n * Set the current OpenTok session\n * @param {Object} otSession\n */\n\n\n/**\n * Get the current OpenTok credentials\n * @returns {Object}\n */\n\n\n/**\n * Set the current OpenTok credentials\n * @param {Object} otCredentials\n */\n\n\n/**\n * Get the options defined for core\n * @returns {Object}\n */\n\n\n/**\n * Set the options defined for core\n * @param {Object} otOptions\n */\n\n\n/**\n * Add a stream to state\n * @param {Object} stream - An OpenTok stream object\n */\n\n\n/**\n * Remove a stream from state and any associated subscribers\n * @param {Object} stream - An OpenTok stream object\n */\n\n\n/**\n * Get all remote streams\n * @returns {Object}\n */\n\n\n/**\n * Get the map of stream ids to publisher/subscriber ids\n * @returns {Object}\n */\n\n\n/**\n * Add a publisher to state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} publisher - The OpenTok publisher object\n */\n\n\n/**\n * Remove a publisher from state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} publisher - The OpenTok publisher object\n */\n\n\n/**\n * Remove all publishers from state\n */\n\n\n/**\n * Add a subscriber to state\n * @param {Object} - An OpenTok subscriber object\n */\n\n\n/**\n * Remove a publisher from state\n * @param {String} type - 'camera' or 'screen'\n * @param {Object} subscriber - The OpenTok subscriber object\n */\n\n\n/**\n * Remove all subscribers from state\n */\n\n\n/**\n * Reset state\n */\n;\n\n/** Export */\n\n\nexports.default = State;"]},"metadata":{},"sourceType":"script"}
{"ast":null,"code":"var _jsxFileName = \"/home/fizoumizou/Documents/pfe/react/src/components/Chat/Main/Main.js\";\nimport React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport Logo from \"../../../assets/img/logo_2x.png\";\nimport WelcomeBoard from \"../WelcomeBoard/WelcomeBoard\";\nimport classNames from 'classnames';\nimport AccCore from 'opentok-accelerator-core';\nimport 'opentok-solutions-css';\nimport './opentok/chat.css';\nimport Helmet from 'helmet';\nimport \"./Main.css\";\nimport { AppString, broadcastData, JOIN_CALL } from \"./../../../constant\";\nimport Spinner from 'react-spinner';\nlet apiKey;\nlet sessionId;\nlet token;\nlet otCore;\nlet otCoreOptions = {\n  credentials: {\n    apiKey: \"46799264\",\n    sessionId: \"1_MX40Njc5OTI2NH5-MTU5NDk5MDIyNDg1MH55WUI2aXZORGlpamR1QlpoYXFSVmdQNjR-fg\",\n    token: \"T1==cGFydG5lcl9pZD00Njc5OTI2NCZzaWc9YzA1OTFiZjUyYjMwZDYzM2JiZDVlMzNkNzg1Y2MzYzk5NmJmZDRjMDpzZXNzaW9uX2lkPTFfTVg0ME5qYzVPVEkyTkg1LU1UVTVORGs1TURJeU5EZzFNSDU1V1VJMmFYWk9SR2xwYW1SMVFscG9ZWEZTVm1kUU5qUi1mZyZjcmVhdGVfdGltZT0xNTk0OTkwMjI0JnJvbGU9bW9kZXJhdG9yJm5vbmNlPTE1OTQ5OTAyMjQuODU4NzE2MjkxOTQzOTE=\"\n  },\n\n  // A container can either be a query selector or an HTML Element\n  streamContainers(pubSub, type, data, stream) {\n    return {\n      publisher: {\n        camera: '#cameraPublisherContainer',\n        screen: '#screenPublisherContainer'\n      },\n      subscriber: {\n        camera: '#cameraSubscriberContainer',\n        screen: '#screenSubscriberContainer'\n      }\n    }[pubSub][type];\n  },\n\n  controlsContainer: '#controls',\n  packages: ['textChat', 'screenSharing', 'annotation'],\n  communication: {\n    callProperties: null // Using default\n\n  },\n  textChat: {\n    name: ['Mahmoud', 'Anis', 'Mahmoud', 'Anis', 'Mahmoud'][Math.random() * 5 | 0],\n    // eslint-disable-line no-bitwise\n    waitingMessage: 'Messages will be delivered when other users arrive',\n    container: '#chat'\n  },\n  screenSharing: {\n    extensionID: 'plocfffmbcclpdifaikiikgplfnepkpo',\n    annotation: true,\n    externalWindow: false,\n    dev: true,\n    screenProperties: {\n      insertMode: 'append',\n      width: '100%',\n      height: '100%',\n      showControls: false,\n      style: {\n        buttonDisplayMode: 'off'\n      },\n      videoSource: 'window',\n      fitMode: 'contain' // Using default\n\n    }\n  },\n  annotation: {\n    absoluteParent: {\n      publisher: '.App-video-container',\n      subscriber: '.App-video-container'\n    }\n  }\n};\n\nconst containerClasses = state => {\n  const {\n    active,\n    meta,\n    localAudioEnabled,\n    localVideoEnabled\n  } = state;\n  const sharingScreen = meta ? !!meta.publisher.screen : false;\n  const viewingSharedScreen = meta ? meta.subscriber.screen : false;\n  const activeCameraSubscribers = meta ? meta.subscriber.camera : 0;\n  const activeCameraSubscribersGt2 = activeCameraSubscribers > 2;\n  const activeCameraSubscribersOdd = activeCameraSubscribers % 2;\n  const screenshareActive = viewingSharedScreen || sharingScreen;\n  return {\n    controlClass: classNames('App-control-container', {\n      hidden: !active\n    }),\n    localAudioClass: classNames('ots-video-control circle audio', {\n      hidden: !active,\n      muted: !localAudioEnabled\n    }),\n    localVideoClass: classNames('ots-video-control circle video', {\n      hidden: !active,\n      muted: !localVideoEnabled\n    }),\n    localCallClass: classNames('ots-video-control circle end-call', {\n      hidden: !active\n    }),\n    cameraPublisherClass: classNames('video-container', {\n      hidden: !active,\n      small: !!activeCameraSubscribers || screenshareActive,\n      left: screenshareActive\n    }),\n    screenPublisherClass: classNames('video-container', {\n      hidden: !active || !sharingScreen\n    }),\n    cameraSubscriberClass: classNames('video-container', {\n      hidden: !active || !activeCameraSubscribers\n    }, {\n      'active-gt2': activeCameraSubscribersGt2 && !screenshareActive\n    }, {\n      'active-odd': activeCameraSubscribersOdd && !screenshareActive\n    }, {\n      small: screenshareActive\n    }),\n    screenSubscriberClass: classNames('video-container', {\n      hidden: !viewingSharedScreen || !active\n    })\n  };\n};\n\nconst connectingMask = () => /*#__PURE__*/React.createElement(\"div\", {\n  className: \"App-mask\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 3\n  }\n}, /*#__PURE__*/React.createElement(Spinner, {\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }\n}), /*#__PURE__*/React.createElement(\"div\", {\n  className: \"message with-spinner\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 5\n  }\n}, \"Connecting\"));\n\nconst startCallMask = start => /*#__PURE__*/React.createElement(\"div\", {\n  className: \"App-mask\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 107,\n    columnNumber: 3\n  }\n}, /*#__PURE__*/React.createElement(\"button\", {\n  className: \"message button clickable\",\n  onClick: start,\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 5\n  }\n}, \"Click to Start Call \"));\n\nclass Main extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: false,\n      connected: false,\n      active: false,\n      publishers: null,\n      subscribers: null,\n      meta: null,\n      localAudioEnabled: true,\n      localVideoEnabled: true,\n      openPage: false\n    };\n    this.currentUserId = localStorage.getItem(AppString.ID);\n    this.currentUserAvatar = localStorage.getItem(AppString.PHOTO_URL);\n    this.currentUserNickname = localStorage.getItem(AppString.NICKNAME);\n    this.startCall = this.startCall.bind(this); // this.openPage = this.openPage.bind(this);\n\n    this.endCall = this.endCall.bind(this);\n    this.toggleLocalAudio = this.toggleLocalAudio.bind(this);\n    this.toggleLocalVideo = this.toggleLocalVideo.bind(this);\n  }\n\n  componentDidMount() {\n    otCore = new AccCore(otCoreOptions);\n    otCore.connect().then(() => this.setState({\n      connected: true\n    }));\n    const events = ['subscribeToCamera', 'unsubscribeFromCamera', 'subscribeToScreen', 'unsubscribeFromScreen', 'startScreenShare', 'endScreenShare'];\n    events.forEach(event => otCore.on(event, ({\n      publishers,\n      subscribers,\n      meta\n    }) => {\n      this.setState({\n        publishers,\n        subscribers,\n        meta\n      });\n    }));\n  } // startCall = () => {\n  //   const {  user } = this.props;\n  //   const { rmUser } = this.props.location.state\n  //   let data = { from: user.id, to: rmUser.id, type: JOIN_CALL}\n  //   broadcastData(data)\n  // }\n  // openPage() {\n  //   this.setState({openPage: true});\n  // }\n\n\n  startCall() {\n    otCore.startCall().then(({\n      publishers,\n      subscribers,\n      meta\n    }) => {\n      this.setState({\n        publishers,\n        subscribers,\n        meta,\n        active: true\n      });\n    }).catch(error => console.log(error));\n  }\n\n  endCall() {\n    otCore.endCall();\n    this.setState({\n      active: false\n    });\n  }\n\n  toggleLocalAudio() {\n    otCore.toggleLocalAudio(!this.state.localAudioEnabled);\n    this.setState({\n      localAudioEnabled: !this.state.localAudioEnabled\n    });\n  }\n\n  toggleLocalVideo() {\n    otCore.toggleLocalVideo(!this.state.localVideoEnabled);\n    this.setState({\n      localVideoEnabled: !this.state.localVideoEnabled\n    });\n  }\n\n  render() {\n    const {\n      connected,\n      active,\n      openPage\n    } = this.state;\n    const {\n      localAudioClass,\n      localVideoClass,\n      localCallClass,\n      controlClass,\n      cameraPublisherClass,\n      screenPublisherClass,\n      cameraSubscriberClass,\n      screenSubscriberClass\n    } = containerClasses(this.state);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"chat__root\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"chat__header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: Logo,\n      alt: \"logo\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 11\n      }\n    })), !openPage ? /*#__PURE__*/React.createElement(\"div\", {\n      className: \"chat_body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"row\",\n      style: {\n        padding: '20px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"chat\",\n      className: \"App-chat-container\",\n      style: {\n        padding: '20px'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 23\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App-main\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App-video-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 25\n      }\n    }, !connected && connectingMask(), connected && !active && startCallMask(this.startCall), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"cameraPublisherContainer\",\n      className: cameraPublisherClass,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 27\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"screenPublisherContainer\",\n      className: screenPublisherClass,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 27\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"cameraSubscriberContainer\",\n      className: cameraSubscriberClass,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 27\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"screenSubscriberContainer\",\n      className: screenSubscriberClass,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 27\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"controls\",\n      className: controlClass,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: localAudioClass,\n      onClick: this.toggleLocalAudio,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 27\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: localVideoClass,\n      onClick: this.toggleLocalVideo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 27\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: localCallClass,\n      onClick: this.endCall,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 27\n      }\n    })))))) : /*#__PURE__*/React.createElement(\"div\", {\n      className: \"chat_body\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"viewBoard\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(WelcomeBoard, {\n      currentUserNickname: this.currentUserNickname,\n      currentUserAvatar: this.currentUserAvatar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 23\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"col-md-12\",\n      style: {\n        position: 'absolute',\n        bottom: 10\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn btn-primary btn-sm w-auto\",\n      style: {\n        marginLeft: '10px'\n      },\n      onClick: this.openPage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 25\n      }\n    }, \"Start Video Call\"))));\n  }\n\n}\n\nexport default withRouter(Main);","map":{"version":3,"sources":["/home/fizoumizou/Documents/pfe/react/src/components/Chat/Main/Main.js"],"names":["React","Component","withRouter","Logo","WelcomeBoard","classNames","AccCore","Helmet","AppString","broadcastData","JOIN_CALL","Spinner","apiKey","sessionId","token","otCore","otCoreOptions","credentials","streamContainers","pubSub","type","data","stream","publisher","camera","screen","subscriber","controlsContainer","packages","communication","callProperties","textChat","name","Math","random","waitingMessage","container","screenSharing","extensionID","annotation","externalWindow","dev","screenProperties","insertMode","width","height","showControls","style","buttonDisplayMode","videoSource","fitMode","absoluteParent","containerClasses","state","active","meta","localAudioEnabled","localVideoEnabled","sharingScreen","viewingSharedScreen","activeCameraSubscribers","activeCameraSubscribersGt2","activeCameraSubscribersOdd","screenshareActive","controlClass","hidden","localAudioClass","muted","localVideoClass","localCallClass","cameraPublisherClass","small","left","screenPublisherClass","cameraSubscriberClass","screenSubscriberClass","connectingMask","startCallMask","start","Main","constructor","props","isLoading","connected","publishers","subscribers","openPage","currentUserId","localStorage","getItem","ID","currentUserAvatar","PHOTO_URL","currentUserNickname","NICKNAME","startCall","bind","endCall","toggleLocalAudio","toggleLocalVideo","componentDidMount","connect","then","setState","events","forEach","event","on","catch","error","console","log","render","padding","position","bottom","marginLeft"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport Logo from \"../../../assets/img/logo_2x.png\";\r\nimport WelcomeBoard from \"../WelcomeBoard/WelcomeBoard\";\r\nimport classNames from 'classnames';\r\nimport AccCore from 'opentok-accelerator-core';\r\nimport 'opentok-solutions-css';\r\nimport './opentok/chat.css';\r\nimport Helmet from 'helmet';\r\n\r\nimport \"./Main.css\";\r\nimport { AppString, broadcastData, JOIN_CALL } from \"./../../../constant\";\r\nimport Spinner from 'react-spinner';\r\n\r\n\r\nlet apiKey;\r\nlet sessionId;\r\nlet token;\r\nlet otCore;\r\n\r\nlet otCoreOptions = {\r\n  credentials: {\r\n    apiKey: \"46799264\",\r\n    sessionId: \"1_MX40Njc5OTI2NH5-MTU5NDk5MDIyNDg1MH55WUI2aXZORGlpamR1QlpoYXFSVmdQNjR-fg\",\r\n    token: \"T1==cGFydG5lcl9pZD00Njc5OTI2NCZzaWc9YzA1OTFiZjUyYjMwZDYzM2JiZDVlMzNkNzg1Y2MzYzk5NmJmZDRjMDpzZXNzaW9uX2lkPTFfTVg0ME5qYzVPVEkyTkg1LU1UVTVORGs1TURJeU5EZzFNSDU1V1VJMmFYWk9SR2xwYW1SMVFscG9ZWEZTVm1kUU5qUi1mZyZjcmVhdGVfdGltZT0xNTk0OTkwMjI0JnJvbGU9bW9kZXJhdG9yJm5vbmNlPTE1OTQ5OTAyMjQuODU4NzE2MjkxOTQzOTE=\",\r\n  },\r\n  // A container can either be a query selector or an HTML Element\r\n  streamContainers(pubSub, type, data, stream) {\r\n    return {\r\n      publisher: {\r\n        camera: '#cameraPublisherContainer',\r\n        screen: '#screenPublisherContainer',\r\n      },\r\n      subscriber: {\r\n        camera: '#cameraSubscriberContainer',\r\n        screen: '#screenSubscriberContainer',\r\n      },\r\n    }[pubSub][type];\r\n  },\r\n  controlsContainer: '#controls',\r\n  packages: ['textChat', 'screenSharing', 'annotation'],\r\n  communication: {\r\n    callProperties: null, // Using default\r\n  },\r\n  textChat: {\r\n    name: ['Mahmoud', 'Anis', 'Mahmoud', 'Anis','Mahmoud'][Math.random() * 5 | 0], // eslint-disable-line no-bitwise\r\n    waitingMessage: 'Messages will be delivered when other users arrive',\r\n    container: '#chat',\r\n  },\r\n  screenSharing: {\r\n    extensionID: 'plocfffmbcclpdifaikiikgplfnepkpo',\r\n    annotation: true,\r\n    externalWindow: false,\r\n    dev: true,\r\n    screenProperties: {\r\n      insertMode: 'append',\r\n      width: '100%',\r\n      height: '100%',\r\n      showControls: false,\r\n      style: {\r\n        buttonDisplayMode: 'off',\r\n      },\r\n      videoSource: 'window',\r\n      fitMode: 'contain' // Using default\r\n    },\r\n  },\r\n  annotation: {\r\n    absoluteParent: {\r\n      publisher: '.App-video-container',\r\n      subscriber: '.App-video-container'\r\n    }\r\n  },\r\n};\r\n\r\nconst containerClasses = (state) => {\r\n  const { active, meta, localAudioEnabled, localVideoEnabled } = state;\r\n  const sharingScreen = meta ? !!meta.publisher.screen : false;\r\n  const viewingSharedScreen = meta ? meta.subscriber.screen : false;\r\n  const activeCameraSubscribers = meta ? meta.subscriber.camera : 0;\r\n  const activeCameraSubscribersGt2 = activeCameraSubscribers > 2;\r\n  const activeCameraSubscribersOdd = activeCameraSubscribers % 2;\r\n  const screenshareActive = viewingSharedScreen || sharingScreen;\r\n  return {\r\n    controlClass: classNames('App-control-container', { hidden: !active }),\r\n    localAudioClass: classNames('ots-video-control circle audio', { hidden: !active, muted: !localAudioEnabled }),\r\n    localVideoClass: classNames('ots-video-control circle video', { hidden: !active, muted: !localVideoEnabled }),\r\n    localCallClass: classNames('ots-video-control circle end-call', { hidden: !active }),\r\n    cameraPublisherClass: classNames('video-container', { hidden: !active, small: !!activeCameraSubscribers || screenshareActive, left: screenshareActive }),\r\n    screenPublisherClass: classNames('video-container', { hidden: !active || !sharingScreen }),\r\n    cameraSubscriberClass: classNames('video-container', { hidden: !active || !activeCameraSubscribers },\r\n      { 'active-gt2': activeCameraSubscribersGt2 && !screenshareActive },\r\n      { 'active-odd': activeCameraSubscribersOdd && !screenshareActive },\r\n      { small: screenshareActive }\r\n    ),\r\n    screenSubscriberClass: classNames('video-container', { hidden: !viewingSharedScreen || !active }),\r\n  };\r\n};\r\n\r\n\r\nconst connectingMask = () =>\r\n  <div className=\"App-mask\">\r\n    <Spinner />\r\n    <div className=\"message with-spinner\">Connecting</div>\r\n  </div>;\r\n\r\nconst startCallMask = start =>\r\n  <div className=\"App-mask\">\r\n    <button className=\"message button clickable\" onClick={start}>Click to Start Call </button>\r\n  </div>;\r\n\r\n\r\nclass Main extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isLoading: false,\r\n      connected: false,\r\n      active: false,\r\n      publishers: null,\r\n      subscribers: null,\r\n      meta: null,\r\n      localAudioEnabled: true,\r\n      localVideoEnabled: true,\r\n      openPage: false,\r\n    };\r\n    this.currentUserId = localStorage.getItem(AppString.ID);\r\n    this.currentUserAvatar = localStorage.getItem(AppString.PHOTO_URL);\r\n    this.currentUserNickname = localStorage.getItem(AppString.NICKNAME);\r\n    this.startCall = this.startCall.bind(this);\r\n    // this.openPage = this.openPage.bind(this);\r\n    this.endCall = this.endCall.bind(this);\r\n    this.toggleLocalAudio = this.toggleLocalAudio.bind(this);\r\n    this.toggleLocalVideo = this.toggleLocalVideo.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    otCore = new AccCore(otCoreOptions);\r\n    otCore.connect().then(() => this.setState({ connected: true }));\r\n    const events = [\r\n      'subscribeToCamera',\r\n      'unsubscribeFromCamera',\r\n      'subscribeToScreen',\r\n      'unsubscribeFromScreen',\r\n      'startScreenShare',\r\n      'endScreenShare',\r\n    ];\r\n    events.forEach(event => otCore.on(event, ({ publishers, subscribers, meta }) => {\r\n      this.setState({ publishers, subscribers, meta });\r\n    }));\r\n  }\r\n\r\n  // startCall = () => {\r\n  //   const {  user } = this.props;\r\n  //   const { rmUser } = this.props.location.state\r\n  //   let data = { from: user.id, to: rmUser.id, type: JOIN_CALL}\r\n  //   broadcastData(data)\r\n  // }\r\n\r\n  // openPage() {\r\n  //   this.setState({openPage: true});\r\n  // }\r\n\r\n  startCall() {\r\n    otCore.startCall()\r\n      .then(({ publishers, subscribers, meta }) => {\r\n        this.setState({ publishers, subscribers, meta, active: true });\r\n      }).catch(error => console.log(error));\r\n  }\r\n\r\n  endCall() {\r\n    otCore.endCall();\r\n    this.setState({ active: false });\r\n  }\r\n\r\n  toggleLocalAudio() {\r\n    otCore.toggleLocalAudio(!this.state.localAudioEnabled);\r\n    this.setState({ localAudioEnabled: !this.state.localAudioEnabled });\r\n  }\r\n\r\n  toggleLocalVideo() {\r\n    otCore.toggleLocalVideo(!this.state.localVideoEnabled);\r\n    this.setState({ localVideoEnabled: !this.state.localVideoEnabled });\r\n  }\r\n\r\n  render() {\r\n    const { connected, active, openPage } = this.state;\r\n    const {\r\n      localAudioClass,\r\n      localVideoClass,\r\n      localCallClass,\r\n      controlClass,\r\n      cameraPublisherClass,\r\n      screenPublisherClass,\r\n      cameraSubscriberClass,\r\n      screenSubscriberClass,\r\n    } = containerClasses(this.state);\r\n    return (\r\n      <div className=\"chat__root\">\r\n        <div className=\"chat__header\">\r\n          <img src={Logo} alt=\"logo\" />\r\n        </div>\r\n        { !openPage ? (\r\n              <div className=\"chat_body\">\r\n                <div className=\"row\" style={{padding: '20px'}}>\r\n                  <div className=\"col-6\">\r\n                      <div id=\"chat\" className=\"App-chat-container\"  style={{padding: '20px'}}/>\r\n                  </div>\r\n                  <div className=\"col-6\">\r\n                      <div className=\"App-main\">\r\n                        {/* <Helmet>\r\n                            <script src=\"https://static.opentok.com/v2/js/opentok.min.js\" type=\"text/javascript\" />\r\n                        </Helmet> */}\r\n                        <div className=\"App-video-container\">\r\n                          { !connected && connectingMask() }\r\n                          { connected && !active && startCallMask(this.startCall)}\r\n                          <div id=\"cameraPublisherContainer\" className={cameraPublisherClass} />\r\n                          <div id=\"screenPublisherContainer\" className={screenPublisherClass} />\r\n                          <div id=\"cameraSubscriberContainer\" className={cameraSubscriberClass} />\r\n                          <div id=\"screenSubscriberContainer\" className={screenSubscriberClass} />\r\n                        </div>\r\n                        <div id=\"controls\" className={controlClass}>\r\n                          <div className={localAudioClass} onClick={this.toggleLocalAudio} />\r\n                          <div className={localVideoClass} onClick={this.toggleLocalVideo} />\r\n                          <div className={localCallClass} onClick={this.endCall} />\r\n                        </div>\r\n                      </div>\r\n                  </div>\r\n                </div>\r\n              </div> ) : (\r\n                <div className=\"chat_body\">\r\n                    <div className=\"viewBoard\">\r\n                      <WelcomeBoard\r\n                        currentUserNickname={this.currentUserNickname}\r\n                        currentUserAvatar={this.currentUserAvatar}\r\n                      />\r\n                    </div>\r\n                    <div className=\"col-md-12\" style={{ position: 'absolute', bottom: 10}}>\r\n                        <button\r\n                          className=\"btn btn-primary btn-sm w-auto\" style={{ marginLeft: '10px'}}\r\n                          onClick={this.openPage}  >\r\n                            Start Video Call\r\n                        </button>\r\n                    </div>\r\n                </div> )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(Main);\r\n"]},"metadata":{},"sourceType":"module"}
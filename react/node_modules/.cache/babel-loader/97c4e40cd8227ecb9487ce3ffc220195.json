{"ast":null,"code":"import _classCallCheck from\"/home/fizoumizou/Documents/pfe/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/fizoumizou/Documents/pfe/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/fizoumizou/Documents/pfe/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/fizoumizou/Documents/pfe/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/fizoumizou/Documents/pfe/react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import{withRouter}from\"react-router-dom\";import Logo from\"../../../assets/img/logo_2x.png\";import WelcomeBoard from\"../WelcomeBoard/WelcomeBoard\";import classNames from'classnames';import AccCore from'opentok-accelerator-core';import'opentok-solutions-css';import'./opentok/chat.css';import Helmet from'helmet';import\"./Main.css\";import{AppString,broadcastData,JOIN_CALL}from\"./../../../constant\";import Spinner from'react-spinner';var apiKey;var sessionId;var token;var otCore;var otCoreOptions={credentials:{apiKey:\"46799264\",sessionId:\"1_MX40Njc5OTI2NH5-MTU5Mjg0NTU1NTM3MH5rUGxOeVUzOEFBVC9ia1pqWnZiaFpsUVR-fg\",token:\"T1==cGFydG5lcl9pZD00Njc5OTI2NCZzaWc9NzcwN2NiYTBlOWYwNjhiNzcxY2E5YjQ5MDA4OTZhNTU1YTM0MzFlZTpzZXNzaW9uX2lkPTFfTVg0ME5qYzVPVEkyTkg1LU1UVTVNamcwTlRVMU5UTTNNSDVyVUd4T2VWVXpPRUZCVkM5aWExcHFXblppYUZwc1VWUi1mZyZjcmVhdGVfdGltZT0xNTkyODQ1NTU1JnJvbGU9bW9kZXJhdG9yJm5vbmNlPTE1OTI4NDU1NTUuMzc2MzQ1MjA2MDUzOA==\"},// A container can either be a query selector or an HTML Element\nstreamContainers:function streamContainers(pubSub,type,data,stream){return{publisher:{camera:'#cameraPublisherContainer',screen:'#screenPublisherContainer'},subscriber:{camera:'#cameraSubscriberContainer',screen:'#screenSubscriberContainer'}}[pubSub][type];},controlsContainer:'#controls',packages:['textChat','screenSharing','annotation'],communication:{callProperties:null// Using default\n},textChat:{name:['David','Paul','Emma','George','Amanda'][Math.random()*5|0],// eslint-disable-line no-bitwise\nwaitingMessage:'Messages will be delivered when other users arrive',container:'#chat'},screenSharing:{extensionID:'plocfffmbcclpdifaikiikgplfnepkpo',annotation:true,externalWindow:false,dev:true,screenProperties:{insertMode:'append',width:'100%',height:'100%',showControls:false,style:{buttonDisplayMode:'off'},videoSource:'window',fitMode:'contain'// Using default\n}},annotation:{absoluteParent:{publisher:'.App-video-container',subscriber:'.App-video-container'}}};var containerClasses=function containerClasses(state){var active=state.active,meta=state.meta,localAudioEnabled=state.localAudioEnabled,localVideoEnabled=state.localVideoEnabled;var sharingScreen=meta?!!meta.publisher.screen:false;var viewingSharedScreen=meta?meta.subscriber.screen:false;var activeCameraSubscribers=meta?meta.subscriber.camera:0;var activeCameraSubscribersGt2=activeCameraSubscribers>2;var activeCameraSubscribersOdd=activeCameraSubscribers%2;var screenshareActive=viewingSharedScreen||sharingScreen;return{controlClass:classNames('App-control-container',{hidden:!active}),localAudioClass:classNames('ots-video-control circle audio',{hidden:!active,muted:!localAudioEnabled}),localVideoClass:classNames('ots-video-control circle video',{hidden:!active,muted:!localVideoEnabled}),localCallClass:classNames('ots-video-control circle end-call',{hidden:!active}),cameraPublisherClass:classNames('video-container',{hidden:!active,small:!!activeCameraSubscribers||screenshareActive,left:screenshareActive}),screenPublisherClass:classNames('video-container',{hidden:!active||!sharingScreen}),cameraSubscriberClass:classNames('video-container',{hidden:!active||!activeCameraSubscribers},{'active-gt2':activeCameraSubscribersGt2&&!screenshareActive},{'active-odd':activeCameraSubscribersOdd&&!screenshareActive},{small:screenshareActive}),screenSubscriberClass:classNames('video-container',{hidden:!viewingSharedScreen||!active})};};var connectingMask=function connectingMask(){return/*#__PURE__*/React.createElement(\"div\",{className:\"App-mask\"},/*#__PURE__*/React.createElement(Spinner,null),/*#__PURE__*/React.createElement(\"div\",{className:\"message with-spinner\"},\"Connecting\"));};var startCallMask=function startCallMask(start){return/*#__PURE__*/React.createElement(\"div\",{className:\"App-mask\"},/*#__PURE__*/React.createElement(\"button\",{className:\"message button clickable\",onClick:start},\"Click to Start Call \"));};var Main=/*#__PURE__*/function(_Component){_inherits(Main,_Component);var _super=_createSuper(Main);function Main(props){var _this;_classCallCheck(this,Main);_this=_super.call(this,props);_this.state={isLoading:false,connected:false,active:false,publishers:null,subscribers:null,meta:null,localAudioEnabled:true,localVideoEnabled:true,openPage:false};_this.currentUserId=localStorage.getItem(AppString.ID);_this.currentUserAvatar=localStorage.getItem(AppString.PHOTO_URL);_this.currentUserNickname=localStorage.getItem(AppString.NICKNAME);_this.startCall=_this.startCall.bind(_assertThisInitialized(_this));// this.openPage = this.openPage.bind(this);\n_this.endCall=_this.endCall.bind(_assertThisInitialized(_this));_this.toggleLocalAudio=_this.toggleLocalAudio.bind(_assertThisInitialized(_this));_this.toggleLocalVideo=_this.toggleLocalVideo.bind(_assertThisInitialized(_this));return _this;}_createClass(Main,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;otCore=new AccCore(otCoreOptions);otCore.connect().then(function(){return _this2.setState({connected:true});});var events=['subscribeToCamera','unsubscribeFromCamera','subscribeToScreen','unsubscribeFromScreen','startScreenShare','endScreenShare'];events.forEach(function(event){return otCore.on(event,function(_ref){var publishers=_ref.publishers,subscribers=_ref.subscribers,meta=_ref.meta;_this2.setState({publishers:publishers,subscribers:subscribers,meta:meta});});});}// startCall = () => {\n//   const {  user } = this.props;\n//   const { rmUser } = this.props.location.state\n//   let data = { from: user.id, to: rmUser.id, type: JOIN_CALL}\n//   broadcastData(data)\n// }\n// openPage() {\n//   this.setState({openPage: true});\n// }\n},{key:\"startCall\",value:function startCall(){var _this3=this;otCore.startCall().then(function(_ref2){var publishers=_ref2.publishers,subscribers=_ref2.subscribers,meta=_ref2.meta;_this3.setState({publishers:publishers,subscribers:subscribers,meta:meta,active:true});}).catch(function(error){return console.log(error);});}},{key:\"endCall\",value:function endCall(){otCore.endCall();this.setState({active:false});}},{key:\"toggleLocalAudio\",value:function toggleLocalAudio(){otCore.toggleLocalAudio(!this.state.localAudioEnabled);this.setState({localAudioEnabled:!this.state.localAudioEnabled});}},{key:\"toggleLocalVideo\",value:function toggleLocalVideo(){otCore.toggleLocalVideo(!this.state.localVideoEnabled);this.setState({localVideoEnabled:!this.state.localVideoEnabled});}},{key:\"render\",value:function render(){var _this$state=this.state,connected=_this$state.connected,active=_this$state.active,openPage=_this$state.openPage;var _containerClasses=containerClasses(this.state),localAudioClass=_containerClasses.localAudioClass,localVideoClass=_containerClasses.localVideoClass,localCallClass=_containerClasses.localCallClass,controlClass=_containerClasses.controlClass,cameraPublisherClass=_containerClasses.cameraPublisherClass,screenPublisherClass=_containerClasses.screenPublisherClass,cameraSubscriberClass=_containerClasses.cameraSubscriberClass,screenSubscriberClass=_containerClasses.screenSubscriberClass;return/*#__PURE__*/React.createElement(\"div\",{className:\"chat__root\"},/*#__PURE__*/React.createElement(\"div\",{className:\"chat__header\"},/*#__PURE__*/React.createElement(\"img\",{src:Logo,alt:\"logo\"})),!openPage?/*#__PURE__*/React.createElement(\"div\",{className:\"chat_body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"row\",style:{padding:'20px'}},/*#__PURE__*/React.createElement(\"div\",{className:\"col-6\"},/*#__PURE__*/React.createElement(\"div\",{id:\"chat\",className:\"App-chat-container\",style:{padding:'20px'}})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-6\"},/*#__PURE__*/React.createElement(\"div\",{className:\"App-main\"},/*#__PURE__*/React.createElement(\"div\",{className:\"App-video-container\"},!connected&&connectingMask(),connected&&!active&&startCallMask(this.startCall),/*#__PURE__*/React.createElement(\"div\",{id:\"cameraPublisherContainer\",className:cameraPublisherClass}),/*#__PURE__*/React.createElement(\"div\",{id:\"screenPublisherContainer\",className:screenPublisherClass}),/*#__PURE__*/React.createElement(\"div\",{id:\"cameraSubscriberContainer\",className:cameraSubscriberClass}),/*#__PURE__*/React.createElement(\"div\",{id:\"screenSubscriberContainer\",className:screenSubscriberClass})),/*#__PURE__*/React.createElement(\"div\",{id:\"controls\",className:controlClass},/*#__PURE__*/React.createElement(\"div\",{className:localAudioClass,onClick:this.toggleLocalAudio}),/*#__PURE__*/React.createElement(\"div\",{className:localVideoClass,onClick:this.toggleLocalVideo}),/*#__PURE__*/React.createElement(\"div\",{className:localCallClass,onClick:this.endCall})))))):/*#__PURE__*/React.createElement(\"div\",{className:\"chat_body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"viewBoard\"},/*#__PURE__*/React.createElement(WelcomeBoard,{currentUserNickname:this.currentUserNickname,currentUserAvatar:this.currentUserAvatar})),/*#__PURE__*/React.createElement(\"div\",{className:\"col-md-12\",style:{position:'absolute',bottom:10}},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-primary btn-sm w-auto\",style:{marginLeft:'10px'},onClick:this.openPage},\"Start Video Call\"))));}}]);return Main;}(Component);export default withRouter(Main);","map":{"version":3,"sources":["/home/fizoumizou/Documents/pfe/react/src/components/Chat/Main/Main.js"],"names":["React","Component","withRouter","Logo","WelcomeBoard","classNames","AccCore","Helmet","AppString","broadcastData","JOIN_CALL","Spinner","apiKey","sessionId","token","otCore","otCoreOptions","credentials","streamContainers","pubSub","type","data","stream","publisher","camera","screen","subscriber","controlsContainer","packages","communication","callProperties","textChat","name","Math","random","waitingMessage","container","screenSharing","extensionID","annotation","externalWindow","dev","screenProperties","insertMode","width","height","showControls","style","buttonDisplayMode","videoSource","fitMode","absoluteParent","containerClasses","state","active","meta","localAudioEnabled","localVideoEnabled","sharingScreen","viewingSharedScreen","activeCameraSubscribers","activeCameraSubscribersGt2","activeCameraSubscribersOdd","screenshareActive","controlClass","hidden","localAudioClass","muted","localVideoClass","localCallClass","cameraPublisherClass","small","left","screenPublisherClass","cameraSubscriberClass","screenSubscriberClass","connectingMask","startCallMask","start","Main","props","isLoading","connected","publishers","subscribers","openPage","currentUserId","localStorage","getItem","ID","currentUserAvatar","PHOTO_URL","currentUserNickname","NICKNAME","startCall","bind","endCall","toggleLocalAudio","toggleLocalVideo","connect","then","setState","events","forEach","event","on","catch","error","console","log","padding","position","bottom","marginLeft"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport Logo from \"../../../assets/img/logo_2x.png\";\r\nimport WelcomeBoard from \"../WelcomeBoard/WelcomeBoard\";\r\nimport classNames from 'classnames';\r\nimport AccCore from 'opentok-accelerator-core';\r\nimport 'opentok-solutions-css';\r\nimport './opentok/chat.css';\r\nimport Helmet from 'helmet';\r\n\r\nimport \"./Main.css\";\r\nimport { AppString, broadcastData, JOIN_CALL } from \"./../../../constant\";\r\nimport Spinner from 'react-spinner';\r\n\r\n\r\nlet apiKey;\r\nlet sessionId;\r\nlet token;\r\nlet otCore;\r\n\r\nlet otCoreOptions = {\r\n  credentials: {\r\n    apiKey: \"46799264\",\r\n    sessionId: \"1_MX40Njc5OTI2NH5-MTU5Mjg0NTU1NTM3MH5rUGxOeVUzOEFBVC9ia1pqWnZiaFpsUVR-fg\",\r\n    token: \"T1==cGFydG5lcl9pZD00Njc5OTI2NCZzaWc9NzcwN2NiYTBlOWYwNjhiNzcxY2E5YjQ5MDA4OTZhNTU1YTM0MzFlZTpzZXNzaW9uX2lkPTFfTVg0ME5qYzVPVEkyTkg1LU1UVTVNamcwTlRVMU5UTTNNSDVyVUd4T2VWVXpPRUZCVkM5aWExcHFXblppYUZwc1VWUi1mZyZjcmVhdGVfdGltZT0xNTkyODQ1NTU1JnJvbGU9bW9kZXJhdG9yJm5vbmNlPTE1OTI4NDU1NTUuMzc2MzQ1MjA2MDUzOA==\",\r\n  },\r\n  // A container can either be a query selector or an HTML Element\r\n  streamContainers(pubSub, type, data, stream) {\r\n    return {\r\n      publisher: {\r\n        camera: '#cameraPublisherContainer',\r\n        screen: '#screenPublisherContainer',\r\n      },\r\n      subscriber: {\r\n        camera: '#cameraSubscriberContainer',\r\n        screen: '#screenSubscriberContainer',\r\n      },\r\n    }[pubSub][type];\r\n  },\r\n  controlsContainer: '#controls',\r\n  packages: ['textChat', 'screenSharing', 'annotation'],\r\n  communication: {\r\n    callProperties: null, // Using default\r\n  },\r\n  textChat: {\r\n    name: ['David', 'Paul', 'Emma', 'George', 'Amanda'][Math.random() * 5 | 0], // eslint-disable-line no-bitwise\r\n    waitingMessage: 'Messages will be delivered when other users arrive',\r\n    container: '#chat',\r\n  },\r\n  screenSharing: {\r\n    extensionID: 'plocfffmbcclpdifaikiikgplfnepkpo',\r\n    annotation: true,\r\n    externalWindow: false,\r\n    dev: true,\r\n    screenProperties: {\r\n      insertMode: 'append',\r\n      width: '100%',\r\n      height: '100%',\r\n      showControls: false,\r\n      style: {\r\n        buttonDisplayMode: 'off',\r\n      },\r\n      videoSource: 'window',\r\n      fitMode: 'contain' // Using default\r\n    },\r\n  },\r\n  annotation: {\r\n    absoluteParent: {\r\n      publisher: '.App-video-container',\r\n      subscriber: '.App-video-container'\r\n    }\r\n  },\r\n};\r\n\r\nconst containerClasses = (state) => {\r\n  const { active, meta, localAudioEnabled, localVideoEnabled } = state;\r\n  const sharingScreen = meta ? !!meta.publisher.screen : false;\r\n  const viewingSharedScreen = meta ? meta.subscriber.screen : false;\r\n  const activeCameraSubscribers = meta ? meta.subscriber.camera : 0;\r\n  const activeCameraSubscribersGt2 = activeCameraSubscribers > 2;\r\n  const activeCameraSubscribersOdd = activeCameraSubscribers % 2;\r\n  const screenshareActive = viewingSharedScreen || sharingScreen;\r\n  return {\r\n    controlClass: classNames('App-control-container', { hidden: !active }),\r\n    localAudioClass: classNames('ots-video-control circle audio', { hidden: !active, muted: !localAudioEnabled }),\r\n    localVideoClass: classNames('ots-video-control circle video', { hidden: !active, muted: !localVideoEnabled }),\r\n    localCallClass: classNames('ots-video-control circle end-call', { hidden: !active }),\r\n    cameraPublisherClass: classNames('video-container', { hidden: !active, small: !!activeCameraSubscribers || screenshareActive, left: screenshareActive }),\r\n    screenPublisherClass: classNames('video-container', { hidden: !active || !sharingScreen }),\r\n    cameraSubscriberClass: classNames('video-container', { hidden: !active || !activeCameraSubscribers },\r\n      { 'active-gt2': activeCameraSubscribersGt2 && !screenshareActive },\r\n      { 'active-odd': activeCameraSubscribersOdd && !screenshareActive },\r\n      { small: screenshareActive }\r\n    ),\r\n    screenSubscriberClass: classNames('video-container', { hidden: !viewingSharedScreen || !active }),\r\n  };\r\n};\r\n\r\n\r\nconst connectingMask = () =>\r\n  <div className=\"App-mask\">\r\n    <Spinner />\r\n    <div className=\"message with-spinner\">Connecting</div>\r\n  </div>;\r\n\r\nconst startCallMask = start =>\r\n  <div className=\"App-mask\">\r\n    <button className=\"message button clickable\" onClick={start}>Click to Start Call </button>\r\n  </div>;\r\n\r\n\r\nclass Main extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isLoading: false,\r\n      connected: false,\r\n      active: false,\r\n      publishers: null,\r\n      subscribers: null,\r\n      meta: null,\r\n      localAudioEnabled: true,\r\n      localVideoEnabled: true,\r\n      openPage: false,\r\n    };\r\n    this.currentUserId = localStorage.getItem(AppString.ID);\r\n    this.currentUserAvatar = localStorage.getItem(AppString.PHOTO_URL);\r\n    this.currentUserNickname = localStorage.getItem(AppString.NICKNAME);\r\n    this.startCall = this.startCall.bind(this);\r\n    // this.openPage = this.openPage.bind(this);\r\n    this.endCall = this.endCall.bind(this);\r\n    this.toggleLocalAudio = this.toggleLocalAudio.bind(this);\r\n    this.toggleLocalVideo = this.toggleLocalVideo.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    otCore = new AccCore(otCoreOptions);\r\n    otCore.connect().then(() => this.setState({ connected: true }));\r\n    const events = [\r\n      'subscribeToCamera',\r\n      'unsubscribeFromCamera',\r\n      'subscribeToScreen',\r\n      'unsubscribeFromScreen',\r\n      'startScreenShare',\r\n      'endScreenShare',\r\n    ];\r\n    events.forEach(event => otCore.on(event, ({ publishers, subscribers, meta }) => {\r\n      this.setState({ publishers, subscribers, meta });\r\n    }));\r\n  }\r\n\r\n  // startCall = () => {\r\n  //   const {  user } = this.props;\r\n  //   const { rmUser } = this.props.location.state\r\n  //   let data = { from: user.id, to: rmUser.id, type: JOIN_CALL}\r\n  //   broadcastData(data)\r\n  // }\r\n\r\n  // openPage() {\r\n  //   this.setState({openPage: true});\r\n  // }\r\n\r\n  startCall() {\r\n    otCore.startCall()\r\n      .then(({ publishers, subscribers, meta }) => {\r\n        this.setState({ publishers, subscribers, meta, active: true });\r\n      }).catch(error => console.log(error));\r\n  }\r\n\r\n  endCall() {\r\n    otCore.endCall();\r\n    this.setState({ active: false });\r\n  }\r\n\r\n  toggleLocalAudio() {\r\n    otCore.toggleLocalAudio(!this.state.localAudioEnabled);\r\n    this.setState({ localAudioEnabled: !this.state.localAudioEnabled });\r\n  }\r\n\r\n  toggleLocalVideo() {\r\n    otCore.toggleLocalVideo(!this.state.localVideoEnabled);\r\n    this.setState({ localVideoEnabled: !this.state.localVideoEnabled });\r\n  }\r\n\r\n  render() {\r\n    const { connected, active, openPage } = this.state;\r\n    const {\r\n      localAudioClass,\r\n      localVideoClass,\r\n      localCallClass,\r\n      controlClass,\r\n      cameraPublisherClass,\r\n      screenPublisherClass,\r\n      cameraSubscriberClass,\r\n      screenSubscriberClass,\r\n    } = containerClasses(this.state);\r\n    return (\r\n      <div className=\"chat__root\">\r\n        <div className=\"chat__header\">\r\n          <img src={Logo} alt=\"logo\" />\r\n        </div>\r\n        { !openPage ? (\r\n              <div className=\"chat_body\">\r\n                <div className=\"row\" style={{padding: '20px'}}>\r\n                  <div className=\"col-6\">\r\n                      <div id=\"chat\" className=\"App-chat-container\"  style={{padding: '20px'}}/>\r\n                  </div>\r\n                  <div className=\"col-6\">\r\n                      <div className=\"App-main\">\r\n                        {/* <Helmet>\r\n                            <script src=\"https://static.opentok.com/v2/js/opentok.min.js\" type=\"text/javascript\" />\r\n                        </Helmet> */}\r\n                        <div className=\"App-video-container\">\r\n                          { !connected && connectingMask() }\r\n                          { connected && !active && startCallMask(this.startCall)}\r\n                          <div id=\"cameraPublisherContainer\" className={cameraPublisherClass} />\r\n                          <div id=\"screenPublisherContainer\" className={screenPublisherClass} />\r\n                          <div id=\"cameraSubscriberContainer\" className={cameraSubscriberClass} />\r\n                          <div id=\"screenSubscriberContainer\" className={screenSubscriberClass} />\r\n                        </div>\r\n                        <div id=\"controls\" className={controlClass}>\r\n                          <div className={localAudioClass} onClick={this.toggleLocalAudio} />\r\n                          <div className={localVideoClass} onClick={this.toggleLocalVideo} />\r\n                          <div className={localCallClass} onClick={this.endCall} />\r\n                        </div>\r\n                      </div>\r\n                  </div>\r\n                </div>\r\n              </div> ) : (\r\n                <div className=\"chat_body\">\r\n                    <div className=\"viewBoard\">\r\n                      <WelcomeBoard\r\n                        currentUserNickname={this.currentUserNickname}\r\n                        currentUserAvatar={this.currentUserAvatar}\r\n                      />\r\n                    </div>\r\n                    <div className=\"col-md-12\" style={{ position: 'absolute', bottom: 10}}>\r\n                        <button\r\n                          className=\"btn btn-primary btn-sm w-auto\" style={{ marginLeft: '10px'}}\r\n                          onClick={this.openPage}  >\r\n                            Start Video Call\r\n                        </button>\r\n                    </div>\r\n                </div> )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(Main);\r\n"]},"metadata":{},"sourceType":"module"}
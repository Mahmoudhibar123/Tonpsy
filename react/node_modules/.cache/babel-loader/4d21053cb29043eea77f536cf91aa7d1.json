{"ast":null,"code":"var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n/* global ArchivingAccPack define */\n\n\n(function () {\n  /** Include external dependencies */\n  var $ = void 0;\n\n  if ((typeof module === 'undefined' ? 'undefined' : _typeof(module)) === 'object' && _typeof(module.exports) === 'object') {\n    /* eslint-disable import/no-unresolved */\n    $ = require('jquery');\n    /* eslint-enable import/no-unresolved */\n  } else {\n    $ = this.$;\n  }\n\n  var _startURL = void 0;\n\n  var _stopURL = void 0;\n\n  var _currentArchive = void 0;\n\n  var _shouldAppendControl = void 0;\n\n  var _recording = false;\n  var _controlAdded = false;\n\n  var _accPack = void 0;\n\n  var _session = void 0;\n\n  var _triggerEvent = function _triggerEvent(event, data) {\n    if (_accPack) {\n      _accPack.triggerEvent(event, data);\n    }\n  };\n\n  var _waitingModalTemplate = function _waitingModalTemplate() {\n    return ['<div id=\"otsArchivingModal\" class=\"ots-archiving-modal\">', '<div class=\"modal-content\">', '<div class=\"modal-header\">', '<h2>Archive is being prepared</h2>', '<span id=\"closeArchiveModal\" class=\"close-button\"></span>', '</div>', '<div class=\"modal-info\">', // eslint-disable-next-line max-len\n    '<span class=\"message\"> Your session archive file is now being prepared. You\\'ll recieve a notification as soon as it\\'s ready.  Please be patient, this won\\'t take long.</span>', '</div>', '<div class=\"modal-buttons\">', '<div id=\"closeArchiveModalBtn\" class=\"btn ok\" target=\"_blank\">Ok, Thanks!</div>', '</div>', '</div>', '</div>'].join('\\n');\n  };\n\n  var _readyModalTemplate = function _readyModalTemplate(archive) {\n    var date = new Date(null);\n    date.setSeconds(archive.duration);\n    var duration = date.toISOString().substr(11, 8);\n    var size = (archive.size / (1000 * 1000)).toString().slice(0, 5) + 'mb';\n    return ['<div id=\"otsArchivingModal\" class=\"ots-archiving-modal\">', '<div class=\"modal-content\">', '<div class=\"modal-header\">', '<h2>Archive is ready</h2>', '<span id=\"closeArchiveModal\" class=\"close-button\"></span>', '</div>', '<div class=\"modal-info\">', '<span class=\"archive-id\">' + archive.id + '</span>', // eslint-disable-next-line max-len\n    '<div class=\"archive-details\">Archive details: ' + duration + ' / ' + size + '</div>', '</div>', '<div class=\"modal-buttons\">', '<a href=\"' + archive.url + '\" class=\"btn download\" target=\"_blank\">Download Archive</a>', '</div>', '</div>', '</div>'].join('\\n');\n  };\n  /**\n   * Displays a modal with the status of the archive.  If no archive object is passed,\n   * the 'waiting' modal will be displayed.  If an archive object is passed, the 'ready'\n   * modal will be displayed.\n   * @param {Object} archive\n   */\n\n\n  var _displayModal = function _displayModal(archive) {\n    // Clean up existing modal\n    var existingModal = document.getElementById('otsArchivingModal');\n    existingModal && existingModal.remove();\n    var template = archive ? _readyModalTemplate(archive) : _waitingModalTemplate();\n    var modalParent = document.querySelector('#otsWidget') || document.body;\n    var el = document.createElement('div');\n    el.innerHTML = template;\n    var modal = el.firstChild;\n    modalParent.appendChild(modal);\n    var closeModal = document.getElementById('closeArchiveModal');\n    var closeModalBtn = document.getElementById('closeArchiveModalBtn');\n\n    closeModal.onclick = function () {\n      return modal.remove();\n    };\n\n    if (closeModalBtn) {\n      closeModalBtn.onclick = function () {\n        return modal.remove();\n      };\n    }\n  };\n\n  var start = function start() {\n    $.post(_startURL, {\n      sessionId: _session.id\n    }).then(function (archive) {\n      _currentArchive = archive;\n\n      _triggerEvent('startArchive', archive);\n    }).fail(function (error) {\n      _triggerEvent('archiveError', error);\n    });\n  };\n\n  var stop = function stop() {\n    _triggerEvent('stopArchive');\n\n    _displayModal();\n\n    $.post(_stopURL, {\n      archiveId: _currentArchive.id\n    }).then(function (data) {\n      _displayModal(data);\n\n      _triggerEvent('archiveReady', data);\n    }).fail(function (error) {\n      _triggerEvent('archiveError', error);\n    });\n  };\n\n  var _appendControl = function _appendControl(container) {\n    var feedControls = document.querySelector(container); // eslint-disable-next-line max-len\n\n    var btn = '<div class=\"ots-video-control circle archiving enabled\" id=\"enableArchiving\"></div>';\n    var el = document.createElement('div');\n    el.innerHTML = btn;\n    var enableArchiving = el.firstChild;\n    feedControls.appendChild(enableArchiving);\n    _controlAdded = true;\n\n    enableArchiving.onclick = function () {\n      if (_recording) {\n        _recording = false;\n        document.querySelector('#enableArchiving').classList.remove('active');\n        stop();\n      } else {\n        _recording = true;\n        document.querySelector('#enableArchiving').classList.add('active');\n        start();\n      }\n    };\n  };\n\n  var _registerEvents = function _registerEvents() {\n    var events = ['startArchive', 'stopArchive', 'archiveReady', 'archiveError'];\n\n    _accPack.registerEvents(events);\n  };\n\n  var _addEventListeners = function _addEventListeners() {\n    _accPack.registerEventListener('startCall', function () {\n      if (_controlAdded) {\n        document.getElementById('enableArchiving').classList.remove('ots-hidden');\n      } else {\n        _shouldAppendControl && _appendControl();\n      }\n    });\n\n    _accPack.registerEventListener('endCall', function () {\n      _shouldAppendControl && document.getElementById('enableArchiving').classList.add('ots-hidden');\n    });\n  };\n\n  var _validateOptions = function _validateOptions(options) {\n    var requiredOptions = ['session', 'startURL', 'stopURL'];\n    requiredOptions.forEach(function (option) {\n      if (!options[option]) {\n        throw new Error(['OT: Archiving Accelerator Pack requires a', option].join(''));\n      }\n    });\n    _session = options.session;\n    _startURL = options.startURL;\n    _stopURL = options.stopURL;\n    _accPack = options.accPack;\n    _shouldAppendControl = options.hasOwnProperty('appendControl') ? options.appendControl : true;\n  };\n\n  var ArchivingAccPack = function ArchivingAccPack(options) {\n    _validateOptions(options);\n\n    var controlsContainer = options.controlsContainer || '#feedControls';\n    _shouldAppendControl && _appendControl(controlsContainer);\n\n    _registerEvents();\n\n    _addEventListeners();\n  };\n\n  ArchivingAccPack.prototype = {\n    constructor: ArchivingAccPack,\n    start: start,\n    stop: stop\n  };\n\n  if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    module.exports = ArchivingAccPack;\n  } else if (typeof define === 'function' && define.amd) {\n    define(function () {\n      return ArchivingAccPack;\n    });\n  } else {\n    this.ArchivingAccPack = ArchivingAccPack;\n  }\n}).call(this);","map":{"version":3,"sources":["/home/fizoumizou/Documents/pfe/react/node_modules/opentok-archiving/dist/opentok-archiving.js"],"names":["_typeof","Symbol","iterator","obj","constructor","prototype","$","module","exports","require","_startURL","_stopURL","_currentArchive","_shouldAppendControl","_recording","_controlAdded","_accPack","_session","_triggerEvent","event","data","triggerEvent","_waitingModalTemplate","join","_readyModalTemplate","archive","date","Date","setSeconds","duration","toISOString","substr","size","toString","slice","id","url","_displayModal","existingModal","document","getElementById","remove","template","modalParent","querySelector","body","el","createElement","innerHTML","modal","firstChild","appendChild","closeModal","closeModalBtn","onclick","start","post","sessionId","then","fail","error","stop","archiveId","_appendControl","container","feedControls","btn","enableArchiving","classList","add","_registerEvents","events","registerEvents","_addEventListeners","registerEventListener","_validateOptions","options","requiredOptions","forEach","option","Error","session","startURL","stopURL","accPack","hasOwnProperty","appendControl","ArchivingAccPack","controlsContainer","define","amd","call"],"mappings":"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","sourcesContent":["var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n/* global ArchivingAccPack define */\n(function () {\n  /** Include external dependencies */\n  var $ = void 0;\n\n  if ((typeof module === 'undefined' ? 'undefined' : _typeof(module)) === 'object' && _typeof(module.exports) === 'object') {\n    /* eslint-disable import/no-unresolved */\n    $ = require('jquery');\n    /* eslint-enable import/no-unresolved */\n  } else {\n    $ = this.$;\n  }\n\n  var _startURL = void 0;\n  var _stopURL = void 0;\n  var _currentArchive = void 0;\n  var _shouldAppendControl = void 0;\n  var _recording = false;\n  var _controlAdded = false;\n  var _accPack = void 0;\n  var _session = void 0;\n\n  var _triggerEvent = function _triggerEvent(event, data) {\n    if (_accPack) {\n      _accPack.triggerEvent(event, data);\n    }\n  };\n\n  var _waitingModalTemplate = function _waitingModalTemplate() {\n    return ['<div id=\"otsArchivingModal\" class=\"ots-archiving-modal\">', '<div class=\"modal-content\">', '<div class=\"modal-header\">', '<h2>Archive is being prepared</h2>', '<span id=\"closeArchiveModal\" class=\"close-button\"></span>', '</div>', '<div class=\"modal-info\">', // eslint-disable-next-line max-len\n    '<span class=\"message\"> Your session archive file is now being prepared. You\\'ll recieve a notification as soon as it\\'s ready.  Please be patient, this won\\'t take long.</span>', '</div>', '<div class=\"modal-buttons\">', '<div id=\"closeArchiveModalBtn\" class=\"btn ok\" target=\"_blank\">Ok, Thanks!</div>', '</div>', '</div>', '</div>'].join('\\n');\n  };\n\n  var _readyModalTemplate = function _readyModalTemplate(archive) {\n    var date = new Date(null);\n    date.setSeconds(archive.duration);\n    var duration = date.toISOString().substr(11, 8);\n    var size = (archive.size / (1000 * 1000)).toString().slice(0, 5) + 'mb';\n    return ['<div id=\"otsArchivingModal\" class=\"ots-archiving-modal\">', '<div class=\"modal-content\">', '<div class=\"modal-header\">', '<h2>Archive is ready</h2>', '<span id=\"closeArchiveModal\" class=\"close-button\"></span>', '</div>', '<div class=\"modal-info\">', '<span class=\"archive-id\">' + archive.id + '</span>', // eslint-disable-next-line max-len\n    '<div class=\"archive-details\">Archive details: ' + duration + ' / ' + size + '</div>', '</div>', '<div class=\"modal-buttons\">', '<a href=\"' + archive.url + '\" class=\"btn download\" target=\"_blank\">Download Archive</a>', '</div>', '</div>', '</div>'].join('\\n');\n  };\n\n  /**\n   * Displays a modal with the status of the archive.  If no archive object is passed,\n   * the 'waiting' modal will be displayed.  If an archive object is passed, the 'ready'\n   * modal will be displayed.\n   * @param {Object} archive\n   */\n  var _displayModal = function _displayModal(archive) {\n    // Clean up existing modal\n    var existingModal = document.getElementById('otsArchivingModal');\n    existingModal && existingModal.remove();\n\n    var template = archive ? _readyModalTemplate(archive) : _waitingModalTemplate();\n    var modalParent = document.querySelector('#otsWidget') || document.body;\n    var el = document.createElement('div');\n    el.innerHTML = template;\n\n    var modal = el.firstChild;\n    modalParent.appendChild(modal);\n\n    var closeModal = document.getElementById('closeArchiveModal');\n    var closeModalBtn = document.getElementById('closeArchiveModalBtn');\n\n    closeModal.onclick = function () {\n      return modal.remove();\n    };\n    if (closeModalBtn) {\n      closeModalBtn.onclick = function () {\n        return modal.remove();\n      };\n    }\n  };\n\n  var start = function start() {\n    $.post(_startURL, { sessionId: _session.id }).then(function (archive) {\n      _currentArchive = archive;\n      _triggerEvent('startArchive', archive);\n    }).fail(function (error) {\n      _triggerEvent('archiveError', error);\n    });\n  };\n\n  var stop = function stop() {\n    _triggerEvent('stopArchive');\n    _displayModal();\n    $.post(_stopURL, { archiveId: _currentArchive.id }).then(function (data) {\n      _displayModal(data);\n      _triggerEvent('archiveReady', data);\n    }).fail(function (error) {\n      _triggerEvent('archiveError', error);\n    });\n  };\n\n  var _appendControl = function _appendControl(container) {\n    var feedControls = document.querySelector(container);\n\n    // eslint-disable-next-line max-len\n    var btn = '<div class=\"ots-video-control circle archiving enabled\" id=\"enableArchiving\"></div>';\n\n    var el = document.createElement('div');\n    el.innerHTML = btn;\n\n    var enableArchiving = el.firstChild;\n\n    feedControls.appendChild(enableArchiving);\n\n    _controlAdded = true;\n\n    enableArchiving.onclick = function () {\n      if (_recording) {\n        _recording = false;\n        document.querySelector('#enableArchiving').classList.remove('active');\n        stop();\n      } else {\n        _recording = true;\n        document.querySelector('#enableArchiving').classList.add('active');\n        start();\n      }\n    };\n  };\n\n  var _registerEvents = function _registerEvents() {\n    var events = ['startArchive', 'stopArchive', 'archiveReady', 'archiveError'];\n    _accPack.registerEvents(events);\n  };\n\n  var _addEventListeners = function _addEventListeners() {\n    _accPack.registerEventListener('startCall', function () {\n      if (_controlAdded) {\n        document.getElementById('enableArchiving').classList.remove('ots-hidden');\n      } else {\n        _shouldAppendControl && _appendControl();\n      }\n    });\n\n    _accPack.registerEventListener('endCall', function () {\n      _shouldAppendControl && document.getElementById('enableArchiving').classList.add('ots-hidden');\n    });\n  };\n\n  var _validateOptions = function _validateOptions(options) {\n    var requiredOptions = ['session', 'startURL', 'stopURL'];\n\n    requiredOptions.forEach(function (option) {\n      if (!options[option]) {\n        throw new Error(['OT: Archiving Accelerator Pack requires a', option].join(''));\n      }\n    });\n\n    _session = options.session;\n    _startURL = options.startURL;\n    _stopURL = options.stopURL;\n    _accPack = options.accPack;\n    _shouldAppendControl = options.hasOwnProperty('appendControl') ? options.appendControl : true;\n  };\n\n  var ArchivingAccPack = function ArchivingAccPack(options) {\n    _validateOptions(options);\n\n    var controlsContainer = options.controlsContainer || '#feedControls';\n    _shouldAppendControl && _appendControl(controlsContainer);\n\n    _registerEvents();\n    _addEventListeners();\n  };\n\n  ArchivingAccPack.prototype = {\n    constructor: ArchivingAccPack,\n    start: start,\n    stop: stop\n  };\n\n  if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {\n    module.exports = ArchivingAccPack;\n  } else if (typeof define === 'function' && define.amd) {\n    define(function () {\n      return ArchivingAccPack;\n    });\n  } else {\n    this.ArchivingAccPack = ArchivingAccPack;\n  }\n}).call(this);"]},"metadata":{},"sourceType":"script"}